function rawSpectrum = calculateRamanSpectrum(phi,theta,da,Ngrid,engLevels,wfnGrid,rotWfnPar,molName,Nbasis,alpha,Temp,cut,Ztot);  rawspectrumOrto = [];  rawspectrumPara = [];  polarOperator = generatePolarizability(phi,theta,Ngrid,alpha);  occSum = 0;    for i=1:Nbasis^2,        if (rotWfnPar(i)==1) %even J          if (molName == 'H2'),	      boltzman = 1*exp(-real(engLevels(i)-engLevels(1))/Temp)./Ztot;      end      if (molName == 'D2'),        boltzman = 3*exp(-real(engLevels(i)-engLevels(1))/Temp)./Ztot;      end            occSum += boltzman;      if (occSum > cut) 	break;      end      disp(['Excitations starting from state ',num2str(i),',occupancy ',num2str(boltzman),',covered ',num2str(occSum*100),'% of the total pop']);fflush(stdout);          for j=1:Nbasis^2,        if (rotWfnPar(j)==1) %even J	          polarTensor = integratePolarizability(wfnGrid,i,j,phi,theta,da,Ngrid,polarOperator);	          ramanIntensity = boltzman*abs(trace(polarTensor*polarTensor'));	          frequency = real(engLevels(j)-engLevels(i));	  if (molName == 'H2'),	    rawspectrumPara = [rawspectrumPara; [frequency, ramanIntensity]];	    rawspectrumOrto = [rawspectrumOrto; [frequency, 0]];	  end	  if (molName == 'D2'),	    rawspectrumPara = [rawspectrumPara; [frequency, 0]];	    rawspectrumOrto = [rawspectrumOrto; [frequency, ramanIntensity]];	  end	end      end        end        if (rotWfnPar(i)==-1) %odd J          if (molName == 'H2'),	      boltzman = 3*exp(-real(engLevels(i)-engLevels(1))/Temp)./Ztot;      end      if (molName == 'D2'),        boltzman = 6*exp(-real(engLevels(i)-engLevels(1))/Temp)./Ztot;      end            occSum += boltzman;      if (occSum > cut) 	break;      end      disp(['Excitations starting from state ',num2str(i),',occupancy ',num2str(boltzman),',covered ',num2str(occSum*100),'% of the total pop']);fflush(stdout);          for j=1:Nbasis^2,        if (rotWfnPar(j)==-1) %odd J	        polarTensor = integratePolarizability(wfnGrid,i,j,phi,theta,da,Ngrid,polarOperator);	        ramanIntensity = boltzman*abs(trace(polarTensor*polarTensor'));	        frequency = real(engLevels(j)-engLevels(i));	  if (molName == 'H2'),	    rawspectrumPara = [rawspectrumPara; [frequency, 0]];	    rawspectrumOrto = [rawspectrumOrto; [frequency, ramanIntensity]];	  end	  if (molName == 'D2'),	    rawspectrumPara = [rawspectrumPara; [frequency, ramanIntensity]];	    rawspectrumOrto = [rawspectrumOrto; [frequency, 0]];	  end	end      end        end      end    rawSpectrum = sortrows([rawspectrumPara,rawspectrumOrto(:,2)],1);  end